import{typingInterval as e}from"../helpers/typingInterval.js";import{isInRange as n}from"../helpers/isInRange.js";let t=[];const r=e=>t.find((n=>n.currentNode===e)),s=e=>{const t=(e=>{const n=/(<([^>]+)>)/g,t=[];let r;for(;null!==(r=n.exec(e.innerHTML));){const e=r.index,s=n.lastIndex;t.push([e,s-1])}return t})(e),s=e.innerHTML.split("").map(((s,o)=>{const{matchingLetters:i}=r(e),a=i.includes(o)||s.match(/\s+/g)||((e,t)=>t.some((([t,r])=>n(e,[t,r]))))(o,t),c=String.fromCharCode(65+Math.round(50*Math.random()));return a?s:c})).join("");e.innerHTML=s},o=(e,n)=>{const t=e.innerHTML;for(let s=0;s<n.length;s++){const o=n[s],{matchingLetters:i}=r(e);!i.includes(s)&&o===t[s]&&i.push(s)}},i=async({elements:n},r)=>{t=[...n.map((({currentNode:e})=>({currentNode:e,matchingLetters:[]})))],await new Promise((t=>{n.forEach((async({currentNode:n,text:i})=>{const a="number"==typeof r.scramble?r.scramble:3e3,c=(new Date).getTime();for(;;){s(n),o(n,i),await e(r.interval);const m=n.innerHTML!=i,l=(new Date).getTime()-c<a;if(!m||!l){t();break}}n.innerHTML=i}))})),r.dispatch("done")};export{i as mode};
